"undefined"==typeof console&&(this.console={log:function(t){}}),L.Control.OSMGeocoder=L.Control.extend({options:{collapsed:!0,position:"topright",text:"Locate",bounds:null,email:null,callback:function(t){if(0==t.length)return void console.log("ERROR: didn't find a result");var e=t[0].boundingbox,o=new L.LatLng(e[0],e[2]),n=new L.LatLng(e[1],e[3]),i=new L.LatLngBounds([o,n]);this._map.fitBounds(i)}},_callbackId:0,initialize:function(t){L.Util.setOptions(this,t)},onAdd:function(t){this._map=t;var e="leaflet-control-geocoder",o=this._container=L.DomUtil.create("div",e);L.DomEvent.disableClickPropagation(o);var n=this._form=L.DomUtil.create("form",e+"-form"),i=this._input=document.createElement("input");i.type="text",i.placeholder=this.options.placeholder||"";var s=document.createElement("input");if(s.type="submit",s.value=this.options.text,n.appendChild(i),n.appendChild(s),L.DomEvent.addListener(n,"submit",this._geocode,this),this.options.collapsed){L.DomEvent.addListener(o,"mouseover",this._expand,this),L.DomEvent.addListener(o,"mouseout",this._collapse,this);var a=this._layersLink=L.DomUtil.create("a",e+"-toggle",o);a.href="#",a.title="Nominatim Geocoder",L.DomEvent.addListener(a,L.Browser.touch?"click":"focus",this._expand,this),this._map.on("movestart",this._collapse,this)}else this._expand();return o.appendChild(n),o},_createSearchResult:function(t,e){var o=.005,n=[];return n[0]={},n[0].boundingbox=[parseFloat(t)-o,parseFloat(t)+o,parseFloat(e)-o,parseFloat(e)+o],n[0].class="boundary",n[0].display_name="Position: "+t+" "+e,n[0].lat=t,n[0].lon=e,n},_isLatLon:function(t){var e=/(-?\d+\.\d+)\s(-?\d+\.\d+)/,o=e.exec(t);return void 0!=o?o:(e=/lat\D*(-?\d+\.\d+)\D*lon\D*(-?\d+\.\d+)/,o=e.exec(t),void 0!=o?o:null)},_isLatLon_decMin:function(t){return console.log("is LatLon?: "+t),re=/([ns])\s*(\d+)\D*(\d+\.\d+).?\s*([ew])\s*(\d+)\D*(\d+\.\d+)/i,m=re.exec(t.toLowerCase()),void 0!=m?m:null},_geocode:function(t){L.DomEvent.preventDefault(t);var e=this._input.value;if(null!=this._isLatLon(e)){var o=this._isLatLon(e);return console.log("LatLon: "+o[1]+" "+o[2]),void this.options.callback.call(this,this._createSearchResult(o[1],o[2]))}if(null!=this._isLatLon_decMin(e)){var o=this._isLatLon_decMin(e),n=new Array;return n.n=1,n.s=-1,n.e=1,n.w=-1,void this.options.callback.call(this,this._createSearchResult(n[o[1]]*(Number(o[2])+o[3]/60),n[o[4]]*(Number(o[5])+o[6]/60)))}console.log(this._callbackId),window["_l_osmgeocoder_"+this._callbackId]=L.Util.bind(this.options.callback,this);var i={q:this._input.value,json_callback:"_l_osmgeocoder_"+this._callbackId++,format:"json"};if(this.options.bounds&&null!=this.options.bounds){if(!(this.options.bounds instanceof L.LatLngBounds))return void console.log("bounds must be of type L.LatLngBounds");i.viewbox=this.options.bounds.toBBoxString(),i.bounded=1}this.options.email&&null!=this.options.email&&("string"==typeof this.options.email?i.email=this.options.email:console.log("email must be a string"));var s=location.protocol,a=s+"//nominatim.openstreetmap.org/search"+L.Util.getParamString(i),l=document.createElement("script");l.type="text/javascript",l.src=a,l.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(l)},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-geocoder-expanded","")}});
